"use strict"

var http = require("http");
var fs = require("fs");

var page_ids = ["2004201041", "2021284778", "2014330658", "2020490707",
"2008766603", "2004210066", "2004207533", "2004201988", "2004202553",
"2017678361", "2008738087", "2004206340", "2020842448", "2023095788",
"2020448521", "2023214795", "2004202734", "2004210176", "2009613583",
"2009842486", "2004210254", "2023072311", "2017055096", "2023072317",
"2009880810", "2011367107", "2004210208", "2004201407", "2004201199",
"2004202574", "2017469422", "2019156259", "2004201355", "2004203617",
"2014330665", "2010853322", "2004206992", "2004208098", "2014330699",
"2004202628", "2004202375", "2023098871", "2020488450", "2011796833",
"2004206091", "2004202298", "2008849925", "2009701546", "2014330708",
"2004211664", "2015552579", "2004211382", "2004202547", "2004202644",
"2004201844", "2020457819", "2004202646", "2013405977", "2016626840",
"2004201993", "2004210469", "2004205477", "2004206228", "2015337807",
"2022853903", "2021800133", "2012637445", "2022956724", "2017292951",
"2016011064", "2004207354", "2020557156", "2012976683", "2023072448",
"2012605652", "2008506602", "2018024787", "2004201161", "2018709033",
"2011618427", "2017678563", "2012411416", "2004201790", "2004202280",
"2004210561", "2014330728", "2019269790", "2010793506", "2004202513",
"2004202146", "2021696288", "2022661290", "2019948319", "2008764057",
"2004202564", "2004202133", "2004202268", "2004210407", "2015938895",
"2004201841", "2016145277", "2004210321", "2004207074", "2004201322",
"2004200975", "2004202890", "2004211645", "2004202542", "2009485162",
"2009248452", "2008633451", "2010917082", "2011299173", "2004206345",
"2004206744", "2004201346", "2023095856", "2004202400", "2004202462",
"2019156266", "2004201147", "2015945709", "2023072504", "2011297401",
"2004201044", "2004201994", "2004202195", "2004202608", "2009077476",
"2014330809", "2004202296", "2014330828", "2004210650", "2020659647",
"2004210613", "2004209947", "2022983920", "2015886502", "2004210656",
"2004202450", "2008332016", "2012637606", "2004210475", "2021860401",
"2004208582", "2012637635", "2012200809", "2021751374", "2004202364",
"2004210399", "2004202287", "2014581691", "2004473832", "2021751397",
"2004201030", "2020488086", "2004204650", "2021764259", "2021799666",
"2015956907", "2004202696", "2015956938", "2004209934", "2010733476",
"2004202182", "2023072580", "2023072583", "2009248398", "2004206648",
"2004208300", "2020153926", "2004202278", "2017577820", "2020488162",
"2011299244", "2004202392"];

for (var i = 0; i < page_ids.length; i++) {
	get_page(page_ids[i], save_contents);
};

function get_page(page_id, callback) {
	var url = "http://seattletimes.nwsource.com/mbase/cgi-bin/DisplayPage.pl?document_id=" + page_id;
	http.get(url, function(res) {
		var data = "";
		res.on('data', function (chunk) {
			data += chunk;
		});
		res.on("end", function() {
			callback(data, page_id);
		});
	}).on("error", function() {
		callback(null, page_id);
	});
}

function save_contents(content, page_id) {
	if(content != null) {
		console.log("writing contents for " + page_id);
		fs.writeFile('pages/' + page_id + '.html', content, function (err) {
		  if (err) throw err;
		});
	}

}